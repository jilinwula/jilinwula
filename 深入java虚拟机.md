# 深入Java虚拟机

java体系结构包括四个独立但相关的技术

* java程序设计语言
* java class文件格式
* java应用程序接口 (API)
* java虚拟机

---

java虚拟机的主要任务是装载class文件并且执行其中的字节码。java虚拟机中包含一个类装载器（class loader），它可以从程序和API中装载class文件。java API中只有程序执行是需要的那些类才会被装载。字节码由执行引擎来执行。

---

执行引擎

* 一次性解释字节码

* 即使编译器

    第一次被执行的字节码会被编译成本地机器代码。编译出的本地机器代码会被缓存，当方法以后被调用的时候可以重用。（执行引擎快，但更消耗内存）

* 自适应优化器

    虚拟机开始的时候解释字节码，但是会监视运行中程序的活动，并且会记录下使用最频繁的代码段。程序运行的时候，虚拟机只把那些活动最频繁的代码编译成本地代码，其它的代码继续保留为字节码。
    
* 硬件芯片

    它用本地方法执行java字节码，这种执行引擎是内嵌在芯片里的。
    
---

java有两种方法

* java方法

    java方法是由java语言编写编译成字节码，存储在class文件中的。

* 本地方法

    本地方法是由其它语言编写的，编译成和处理器相关的机器代码。本地方法保存在动态连接库中。格式是各个平台专有的。运行中的java程序调用本地方法时，虚拟机装载包含这个本地方法的动态库，并调用这个方法。
    
---

类装载器

* 启动类装载器（原始类装载器、系统类装载器、默认类装载器）

    这是系统唯一的的，也是java虚拟机的一部分。

* 用户定义类装载器

    可以用java编写，能够被编译为class文件，能被虚拟机装载，还能向其它对象一样实例化。